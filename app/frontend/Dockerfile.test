# Frontend Test Dockerfile - Uses base image with dependencies pre-installed
ARG BASE_IMAGE
FROM ${BASE_IMAGE}

# Switch to root to fix permissions
USER root

# Set working directory
WORKDIR /app

# Copy source code (excluding node_modules and package files which are already in base image)
COPY src/ ./src/
COPY public/ ./public/
COPY tsconfig*.json ./
COPY vite.config.ts ./
COPY index.html ./
COPY eslint.config.js ./
COPY cypress.config.cjs ./
COPY cypress/ ./cypress/
COPY scripts/ ./scripts/

# Fix permissions for the nextjs user
RUN chown -R nextjs:nodejs /app

# Switch back to nextjs user
USER nextjs

# Expose port
EXPOSE 5679

# Default command - run tests without npm to avoid EROFS issues
CMD ["npx", "vitest", "run"]
